# 结构体和数据结构基础

## 结构体


### 结构体的定义

C语言的构造数据类型：

- 数组
- 结构体
- 共用体

**数组**是由相同的数据构成的一种数据结构，适合于对有相同属性的数据进行批处理；

**结构体**是将不同类型的数据成员组织到统一的名字下适合于对关系紧密、逻辑相关、具有相同或不同属性的数据进行处理；

**共用体**也能表示逻辑相关的不同类型的数据集合，但其数据成员是情形互斥的，每一时刻只有一个数据成员起作用。


定义结构体首先得声明一个**结构体模板（Structure Template）**

```c
struct 结构体名
{
    数据类型 成员1的名字;
    数据类型 成员2的名字;
    数据类型 成员3的名字;
    ......
    数据类型 成员n的名字;
};
```

结构体模板是由关键字`struct`及其后的结构体名组成的。分号是结构体声明的结束标志，不能省略。

结构体的名字，称为**结构体标签（Structure Tag）**，作为用户自定义的结构体类型的标志，用于与其它结构体类型相区别。

结构体中的各信息项是在结构体标签后的花括号内声明的；构成结构体的变量，称为**结构体成员（Structure Member）**。结构体成员的命名必须遵循变量的命名规则。




>   注意，结构体模板只是声明了一种数据类型，定义了数据的组织形式，并未声明结构体类型的变量，因而编译器不为其分配内存。

其次，利用已经定义好的结构体数据类型来定义结构体变量。C语言允许按如下两种方式定义结构体变量。

- 先声明结构体模板，再定义结构体变量。

  ```c
  struct student
  {
  	...
  };
  ...
  struct student stu1;
  ```

- 在声明结构体模板的同时定义结构体变量。

  ```c
  struct student
  {
  	...
  }stu1, stu2;
  ```

  当将结构体模板和结构体变量放在一起时，结构体标记是可选的。

### 关键字typedef

关键字`typedef`用于为系统固有的或程序员自定义的数据类型定义一个别名。 数据类型的别名通常使用大写字母，目的是为了与已有的数据类型相区分。

```c
typedef int INTEGER;
typedef struct student STUDENT;
typedef struct student
{
  	long studentID;
    char studentName[10];
    char studentSex;
    int yearOfBirth;
    int score[4];
}STUDENT;
```

>   注意，typedef只是为一种已存在的类型定义一个新的名字而已，并未定义一种新的数据类型。



### 结构体变量的初始化

结构体变量的成员可以通过将成员的初值置于花括号之内来进行初始化。

```c
STUDENT stu1 = { 202121100, "老六", 'm', 2000, { 80, 80, 80, 80 } };
//等价于 struct student stu1 = { 202121100, "老六", 'm', 2000, { 80, 80, 80, 80 } };
```

### 嵌套的结构体

**嵌套的结构体（Nested Structure）**就是在一个结构体内包含了另一个结构体作为其成员。

```c
typedef struct date
{
    int year;
    int month;
    int day;
}DATE;

typedef struct student
{
  	long studentID;
    char studentName[10];
    char studentSex;
   	DATE birthday;
    int score[4];
}STUDENT;

STUDENT stu1 = { 202121100, "老六", 'm', { 2000, 1, 1 }, { 80, 80, 80, 80 } };
```

### 结构体变量的引用

C语言规定，不能将一个结构体变量作为一个整体进行输入、输出操作，只能对每个具体的成员进行输入、输出操作。

访问结构体变量的成员必须使用**成员选择运算符（也称原点运算符）**。其访问格式如下：

```c
[结构体变量名].[成员名]
stu1.studentID = 202121xxx
```

对于结构体成员，可以像其他普通变量一样进行赋值等运算。

**当出现结构体嵌套时，必须以级联方式访问结构体成员，即通过成员选择运算符逐级找到最底层的成员时在引用。**

```c
stu1.birthday.year = 2000
stu1.birthday.month = 1
stu1.birthday.day = 1
```



### 结构体变量的整体赋值

C语言允许对既有相同结构体类型的变量进行整体赋值。在对两个同类型的结构体变量赋值时，实际上是按照结构体的成员顺序注意对相应成员进行赋值操作。注意，并非所有的结构体成员都可以使用赋值运算符来赋值，对字符数组类型的结构体成员进行赋值时，必须使用字符串处理函数`strcpy()`。

> 以结构体`STUDENT`为例，结构体成员`studentName`是一个字符型数组，`studentName`是该数组的名字，代表字符型数组的首地址，是一个常量，不能作为赋值表达式的左值。

### 结构体的作用域

在函数体外声明的结构体类型可为所有函数使用，称为**全局声明**。

在函数体内声明的结构体类型只能在本函数内使用，称为**局部声明**。

### 结构体的内存占用

**结构体变量的地址是结构体变量所占内存空间的首地址，而结构体成员的地址值与结构体成员在结构体中所处的位置及该成员所占内存的字节数有关。**

系统为结构体变量分配内存的大小，或者说结构体类型所占内存的字节数，并非是所有成员所占内存字节数的总和，它不仅与所定义的结构体类型有关，还与计算机系统本身有关。由于结构体变量的成员的内存对齐方式和数据类型所占内存的大小都是与机器有关的，因此结构体在内存中所占字节数也是与机器相关的。

> 对多数计算机系统而言，为了提高内存寻址效率，很多处理器体系结构为特定的数据类型引入了特殊的内存对齐需求。不同的系统和编译器，内存对齐的方式有所不同，为了满足处理器的对其要求，可能会在较小的成员后加入补位，从而导致结构体实际占用的字节数会比我们想象的多出一些字节。

### 结构体数组的定义和初始化

#### 结构体数组的定义

```c
STUDENT stu[30];
```



#### 结构体数组的初始化

```c
STUDENT stu[30] = {{100310121, "张三"， 'M', {1991, 5, 19}, {72, 81, 92, 64}},
                   {100310122, "李四", 'M', {1992, 6, 20}, {83, 32, 63, 62}}
                  };
```

### 结构体指针的定义和初始化

```c
STUDENT *pt;
pt = &stu1;
```

结构体指针通过**指向运算符（也称箭头运算符）**访问结构体指针变量所指向的结构体成员。

```c
指向结构体的指针变量名->成员名
pt->studentID = 100310121;
// 等价于(*pt).studentID = 100310121;
```

指向结构体数组的指针，略。

### 向函数传递结构体

1. 用结构体的单个成员作为函数参数，向函数传递结构体的单个成员。（传值调用）
2. 用结构体变量做函数参数，向函数传递结构体的完整结构。（传值调用）
3. 用结构体指针或结构体数组做函数参数，向函数传递结构体的地址。（传址调用）


## 共用体

共用体，也称**联合（Union）**，是将不同的数据组织在一起共同占用一段内存一种构造数据类型。

### 共用体的定义

共用体的定义：

```c
union sample
{
    short i;
    char ch;
    float f;
};
typedef union sample SAMPLE;
```

### 共用体的内存占用

共用体类型所占内存空间的大小取决于其成员中占内存最多的的哪一个成员变量。



C语言规定，共用体采用与开始地址对齐的方式分配内存空间。如本例中的共用体成员`i`占2个字节，`ch`占一个字节，`f`占4个字节，于是`f`的前1个字节解释为`ch`分配的内存空间，而前2个字节就是为`i`分配的内存空间。

共用体使用覆盖技术来实现内存的共有，在每一瞬间起作用的成员就是最后一次被赋值的成员。
